<launch>

  <arg name="save_dir" default="$(find vzense_demo)/data" />

  <include file="$(find vzense_demo)/launch/vzense.launch" >
    <arg name="gui" value="false" />
  </include>

  <node name="save_request_node"
        pkg="vzense_demo" type="save_request_node.py"
        clear_params="true" output="screen" >
  </node>

  <node name="data_collection_server"
        pkg="jsk_data" type="data_collection_server.py"
        clear_params="true" output="screen" >
    <rosparam subst_value="true">
      save_dir: $(arg save_dir)
      topics:
      - name: /camera/right_vzense_camera/color/image_raw
        msg_class: sensor_msgs/Image
        fname: right.jpg
        savetype: ColorImage
      - name: /camera/left_vzense_camera/color/image_raw
        msg_class: sensor_msgs/Image
        fname: left.jpg
        savetype: ColorImage
    </rosparam>
  </node>


  <group ns="camera" >
    <group ns="left_vzense_camera" >
      <node name="aruco_marker_detector"
            pkg="vzense_demo" type="aruco_marker_detector.py"
            clear_params="true" output="screen" >
        <remap from="~image" to="color/image_raw" />
      </node>
    </group>
    <group ns="right_vzense_camera" >
      <node name="aruco_marker_detector"
            pkg="vzense_demo" type="aruco_marker_detector.py"
            clear_params="true" output="screen" >
        <remap from="~image" to="color/image_raw" />
      </node>
    </group>
  </group>

  <node name="rviz"
        pkg="rviz" type="rviz"
        args="-d $(find vzense_demo)/launch/config/calib_camera.rviz" >
    <rosparam command="load" file="$(find vzense_demo)/config/calib_camera_command.yaml" />
  </node>

</launch>
